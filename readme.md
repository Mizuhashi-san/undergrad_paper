# 本研究に用いたソースコード
明治大学総合数理学部現象数理学科廣瀬研究室の卒業論文「自然言語が構成する Fasttext Embedding Space がもつパーシステントホモロジーによる印欧語族言語の構造比較」に向けたソースコードを掲載しております．GitHub上のipynbファイルを実行することで，研究再現が可能となります．
## `download_vec.py`
このモジュールは，Facebook (Meta) が公開している fastText の事前学習済み単語ベクトルを自動的に取得するための関数download_fasttext_vecが定義されています．スクレイピングパッケージ(requests と BeautifulSoup)を用いて，fastText公式サイトのHTMLから対象ファイルからダウンロードURLを特定してダウンロードします．

## `calc_homology.py`

このモジュールは、fastTextの単語ベクトルデータを読み込み、**TDA（トポロジカル・データ・アナリシス）** の手法を用いてパーシステントホモロジーを計算するためのコア機能を担います。

### 1. 概要
圧縮されたベクトルファイル（`.vec.gz`）から高次元の単語分散表現を抽出し、適切な正規化処理を行った後、**Vietoris-Rips（V-R）複体** に基づくパーシステント図を生成します。距離行列の算出からホモロジー計算までのパイプラインを提供し、処理時間の計測機能も備えています。

### 2. 定義されている関数

#### `vec_frequent(lang_code, num)`
圧縮ファイルから出現頻度上位の単語ベクトルを抽出し、数値配列として整形・正規化します。

- **処理ステップ**:
  - `gzip` モジュールを使用してファイルを展開し、一行ずつ単語とベクトルを分離します．
  - 指定された単語数（`num`）に達した時点で読み込みを終了します．
  - **正規化**: 各ベクトルのL2ノルムの平均値を算出し，その平均値で全ベクトルを割ることでスケーリングを行います．これは位相的構造を維持しつつ，異なるデータセット間での比較を容易にするためです．
- **引数**:
  - `lang_code`: 言語コード（例：'ja', 'en'）
  - `num`: 抽出する単語の数
- **戻り値**: `(vectors, words)` のタプル．`vectors` はNumPyのfloat32配列です．

#### `vietris_rips(point_cloud, metric, lang)`
与えられた点群データから距離行列を作成し，パーシステントホモロジーを計算します．

- **処理ステップ**:
  - **距離行列の生成**: 引数 `metric` に応じて「ユークリッド距離 (`euclidian`)」または「コサイン距離 (`cosine`)」の行列を計算します．
  - **ホモロジー計算**: `ripser` ライブラリを使用し，0次元および1次元のホモロジーを抽出します．計算負荷の増大を防ぐため、最大次元は `maxdim=1` に制限されています．
  - **ログ出力**: 行列計算とホモロジー計算それぞれの処理時間を秒単位で表示します．
- **引数**:
  - `point_cloud`: 正規化済みのベクトルデータ
  - `metric`: 使用する距離尺度（'euclidian' または 'cosine'）
  - `lang`: 出力ログ用の言語ラベル
- **戻り値**: 各次元のパーシステント図データ（`diagrams`）

## `bars_statistics.py`
このモジュールは，計算されたパーシステント図（Diagrams）から統計量（バーの長さや寿命）を算出，その分布を可視化・分析するための機能を提供します．パーシステントホモロジーの結果として得られる「バーコード」の情報を集計し，ホモロジー群の生存期間（Persistence）に関する統計的な特徴を抽出します．
#### `load_diagram_npz(path)`
計算済みのパーシステント図データ（`.npz`）を読み込みます．
- **引数**: `.npz`ファイルへのパス
- **戻り値**: 各次元のダイアグラムを含むリスト

#### `remove_inf(diagram)`
0次ホモロジーにおいて必ず出現する「寿命が無限（$Death = \infty$）」の点を除去し、統計計算への影響を防ぎます．

#### `bars_statistics(pd, col='birth', sta='median')`
パーシステント図から指定された指標の統計量を算出します．
- **指標 (`col`)**: `birth`（生成）, `death`（消失）, `persistence`（生存期間）
- **統計量 (`sta`)**: 
  - 基本統計: `mean`（平均）, `median`（中央値）, `stdev`（標準偏差）, `range`（範囲）
  - 分位点: `10%`, `25%`, `75%`, `90%`, `IQR`（四分位範囲）

#### `coloring(k, lang_list)`
言語コードに基づき、図示の際の色を決定します．
- **分類**: 
  - 赤系：スラブ語群（`ru`, `pl`など）
  - 緑系：ゲルマン語群（`en`, `de`, `no`など）
  - 青系：イタリック語派（`fr`, `it`, `es`など）
  - その他：インド語群（`hi`, `bn`）やバルト語群など

#### `plot_point(iter, lang_list, col, sta, ...)`
異なる距離尺度（例：コサイン距離とユークリッド距離）の間で統計量を比較プロットします．
- **処理内容**: 指定された試行回数（`iter`）分のデータを集計し、散布図を作成します．
- **注記**: 言語ラベルの注釈（Annotate）機能により、個々のデータ点の識別が可能です．
